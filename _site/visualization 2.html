<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Advanced Graphics - Data Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Advanced Graphics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./colors.html" rel="" target="">
 <span class="menu-text">Colors</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./fonts.html" rel="" target="">
 <span class="menu-text">Fonts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./technicalities.html" rel="" target="">
 <span class="menu-text">Technicalities</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./visualization.html" rel="" target="" aria-current="page">
 <span class="menu-text">Data Visualization</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#basic-principles" id="toc-basic-principles" class="nav-link active" data-scroll-target="#basic-principles">Basic Principles</a></li>
  <li><a href="#which-chart-type-should-i-use" id="toc-which-chart-type-should-i-use" class="nav-link" data-scroll-target="#which-chart-type-should-i-use">Which chart type should I use?</a></li>
  <li><a href="#tables" id="toc-tables" class="nav-link" data-scroll-target="#tables">Tables</a></li>
  <li><a href="#good-and-bad-graphs" id="toc-good-and-bad-graphs" class="nav-link" data-scroll-target="#good-and-bad-graphs">Good and Bad Graphs</a>
  <ul class="collapse">
  <li><a href="#good-figures" id="toc-good-figures" class="nav-link" data-scroll-target="#good-figures">Good Figures</a></li>
  <li><a href="#bad-figures" id="toc-bad-figures" class="nav-link" data-scroll-target="#bad-figures">Bad Figures</a></li>
  </ul></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Visualization</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="basic-principles" class="level2">
<h2 class="anchored" data-anchor-id="basic-principles">Basic Principles</h2>
<p>Visualization may not be as precise as statistics, but it provides a unique view onto data that can make it much easier to discover interesting structures than numerical methods. Visualization also provides the context necessary to make better choices and to be more careful when fitting models. Anscombe’s Quartet is a case in point, showing that four datasets that have identical statistical properties can indeed be very different.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="anscombe.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">).</figcaption>
</figure>
</div>
<p>When we visualize data, it means that we are encoding data into visual forms such as colors, size, shape, etc. Although our data pretty much decides which type of graphs we can consider, the human brain cannot decode the information of all types of data visualization equally.</p>
<p>In the mid-1980s, Cleveland and McGill (1985) ran <a href="http://courses.ischool.berkeley.edu/i247/f05/readings/Cleveland_GraphicalPerception_Science85.pdf">experiments</a> measuring how accurately people were able to perceive the quantitative information encoded by different types of data visualization. People were asked to estimate two values within a chart, or compare values between charts. In 2010, Heer &amp; Bostock (2010) <a href="https://dl.acm.org/citation.cfm?id=1753357">replicated</a> Cleveland’s earlier experiments and added additional assessments, such as rectangular-area graphs.</p>
<p>The overall pattern of results shows less accurate perception as we move from length-based scales to angles and finally areas.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="cleveland.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Source: Healy (2019)</figcaption>
</figure>
</div>
<p><em>Schematic representation of basic perceptual tasks for nine chart types, by Heer and Bostock, following Cleveland and McGill. In both studies, participants were asked to make comparisons of highlighted portions of each chart type, and say which was smaller.</em></p>
<p>We best judge a quantity if we have a clear scale on which elements are aligned, such as a denoted y-axis for bar charts. When elements are not clearly marked by a scale, comparison is a bit harder but still good. It is more difficult again to compare the lengths of lines without a common baseline.</p>
<p>We tend to misjudge quantities represented as angles. This is why pie charts are usually a bad idea. We also misjudge areas. We have known for a long time that area-based comparisons of quantities are easily misinterpreted or exaggerated. For example, values in the data might be encoded as lengths which are then squared to make the shape on the graph. The result is that the difference in size between the squares or rectangles area will be much larger than the difference between the two numbers they represent.</p>
<p>Finally, three-dimensional visualization of data is hardest to interprete. Our ability to scan the dimension of depth (z-axis) is weaker than our ability to grasp the x and y axes. Three-dimensional visualization can look impressive, but they are also harder to judge.</p>
<hr>
</section>
<section id="which-chart-type-should-i-use" class="level2">
<h2 class="anchored" data-anchor-id="which-chart-type-should-i-use">Which chart type should I use?</h2>
<p>This is a frequently asked question, and the answer is: There is no best answer. However, you should ask by asking yourself “What would you like to show?”. Below you can see a basic framework to identify different chart types for different data types. Experiment with different charts to see which chart works best to tell the story in your data.</p>
<p><br></p>
<p><img src="choosing-chart.jpg" class="img-fluid"></p>
<p>The most important question you should always ask is: ““What is it about the data that I would like to visualize?”. The struggle of a good visualization is often find not a visualization problem, but an operationalization problem.</p>
<p>Information visualization is not an art, but a systematic process. You need to clarify which attributes of your data you want to highlight, and how these attributes relate to other attributes in the data.</p>
<p><em>When is data visualization useful?</em></p>
<p>The less straight-forward the answer to your question, the more useful data visualization might be. If your question is ‘how many toothpastes did our company sell in a given year?’, you do not need to visualize the numeric answer to that question. However, if you ask how did our toothpaste sells do compared to other toothpaste companies in a given year, a graphic visualization might be useful to look at the differences and comparisons. Vague questions require you to look at your data from different perspectives and angles. Visualizating your data for vague questions can thus be useful to draw inferences based on your own knowledge.</p>
<p>In most statistic courses for social scientists, creating a graph is part of your statistical analysis. You’re being taught to create a graph from your results, to show your effects, or maybe look at the distribution of your data visually.</p>
<p>This ignors that information visualization can be of much greater use than only showing the outcome of an analysis. In fact, the most cited parts of a paper are usually the parts exploring, describing and interpreting the data at hand, which typically requires good and simple visualization. Exploring data visually might then give you indices on how to further work with the data, e.g.&nbsp;statistical analysis, machine learning, network analysis, etc. In other words, information visualization can be vital in the step to a successful operationalization.</p>
<p><em>Types of information visualization</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="typesinfo.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Source: McCandless (2013).</figcaption>
</figure>
</div>
</section>
<section id="tables" class="level2">
<h2 class="anchored" data-anchor-id="tables">Tables</h2>
<p>Tables are usually better than graphics for 20 or less numbers. The special power of graphics comes with large datasets. Tables also work well when the data presentation requires many localized comparisons.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="tufte-table.jpg" class="img-fluid figure-img" style="width:65.0%"></p>
<figcaption class="figure-caption">Source: New York Times, November 9, 1980.</figcaption>
</figure>
</div>
<p>Tables are often presented with rows/cols ordered alphabetically which is good for looking up specific values, but it is bad for seeing patterns, trends, anomalies. It is better to sort rows or columns by means or medians and to shade cells according to values. If you are going to present the numbers, round a lot. Nobody wants to see all those decimals.</p>
<div class="row">
<div class="col-md-6">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ldc-conflict-2.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Basic table, hard to stay on the right line when reading it.</figcaption>
</figure>
</div>
</div>
<div class="col-md-6">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ldc-conflict-1.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Cleaned table, sorted according to countries and status. Shaded areas enhance readability.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="good-and-bad-graphs" class="level2">
<h2 class="anchored" data-anchor-id="good-and-bad-graphs">Good and Bad Graphs</h2>
<p>Like good writing, good graphical displays of data communicate ideas with clarity, precision, and efficiency. Like poor writing, bad graphical displays distort or obscure the data, make it harder to understand or compare, or otherwise thwart the communicative effect which the graph should convey.</p>
<section id="good-figures" class="level3">
<h3 class="anchored" data-anchor-id="good-figures">Good Figures</h3>
<p>Coming across a good visualization in this dense information jungle nowadays is a relief, because it is effortless and just poures in.</p>
<p>After pie charts, double Y-axis graphs have caused more trouble than almost any other</p>
<p>When we look at maps, we tend to focus on the substantive matter of the data and don’t primarily think about the methodology behind it.</p>
<p><em>Time-Series</em></p>
<p>A random sample of 4’000 graphics from 15 popular newspapers and magazins from around the world between 2974 and 1980 showed that 75% of these graphics displayed time-series Tufte (1983). The strength of time-series is the natural ordering of the time scale, and the ability to make big data sets with lots of variability easily visual.</p>
<p>Adding an addiitonal space dimension to time-series (if your data allows) increases explanatory power. The following examples show complex multivariate graphics that are so easy to understand that viewers barely notice the multiple dimensions.</p>
<p><em>Narrative Graphics of Time and Space</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Minard Napoleon.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Minard’s visualization of Napoleon’s retreat from Moscow, Paris 1885.</figcaption>
</figure>
</div>
<p><em>Visual Area and Numerical Measure</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="postale.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Antonio Gabaglio, Teoria Generale della Statistica (Milan, second edition, 1888).</figcaption>
</figure>
</div>
<p><em>Context is essential</em></p>
<p>Good data visualization should always answer the question ‘compared to what?’. Too few data in a graph should always alarm you. Consider the example about traffic deaths in the ‘bad figures’ section.</p>
<p><em>Data-Ink</em></p>
<p>Good information visualization should invoke your focus on the substance of the data and nothing else. STatistical graphics are instruments to help people reason about quantitative information. Data-Ink is the non-erasable core of a graphic, the non-redundant ink arranged in response to variation in the numbers represented. That ink changes as the data changes. You should try to maximize the share of data-ink in your graph. Erase non-data-ink within reason.</p>
<p><em>Chartjunk</em></p>
<p>The decoration of graphs produces a lot of ink that is not necessary to understand the data behind the graph. This non-data-ink is called chartjunk. This can include</p>
<ul>
<li><p>unintentional optical art (eye-catching visual additions to a graph that distracts from the actual information and distorts the reader)</p></li>
<li><p>The Grid (Grids are mostly for the intitial plotting of the data, but they carry no information and clutter up the graphic)</p></li>
<li><p>Self-promoting graphics (when the data measures and elements become the design elements)</p></li>
</ul>
<div class="columns">
<div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bdldc.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Redesign Histogram. The left figure is a basic ggplot2 output in R.</figcaption>
</figure>
</div>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bdldc2.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The right figure is more viewer-friendly and has less Chartjunk, typefont is clear, words run from left to right.</figcaption>
</figure>
</div>
</div>
</div>
<p><em>Maps</em></p>
<p>As the importance of location data continues to grow so do the ways you can visualize this information. Maps are great for an intuitive to look at spatial patterns and great for distributing geographic data. In many cases, just by making a map you are doing analysis. That’s because you’re making the map for a reason. You have a question you want the map to help answer: Where has disease ravaged trees? Which communities are in the path of a wildfire? Where are areas of high crime? It’s also because when you make a map, as with any analysis, you’re making decisions about which information to include and how to present that information. Effective visualization is valuable for communicating results and messages clearly in an engaging way. Here are three key decisions that affect the information a map presents and the story it tells.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bars-vs-grocery.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Source: flowingdata.com (2019)</figcaption>
</figure>
</div>
<p>http://metrocosm.com/global-migration-map.html</p>
<p>https://whitecollar.thenewinquiry.com/#dr5rud9</p>
<p>https://flowingdata.com/2015/12/15/a-day-in-the-life-of-americans/</p>
<p>Tyler Vigen wrote an <a href="http://tylervigen.com/spurious-correlations">algorithm</a> that attempts to automatically find things that correlate.</p>
</section>
<section id="bad-figures" class="level3">
<h3 class="anchored" data-anchor-id="bad-figures">Bad Figures</h3>
<p>The following example is adapted from Tufte (1983). He shows how data out of context can present untruthful results. When presenting results or effects, you should always show the answer to the question ‘compared to what’, such as time before/after or other units.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="traffic1.jpg" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption"><em>Adapted from Tufte (1983)</em></figcaption>
</figure>
</div>
<p>Design that is too data thin should always raise your suspicion and you should consider the question ‘compared to what?’. Here, a few more datapoints lead to a completely different conclusion. In the first figure, one could assume that a stricter enforcement of speed limits lead to a significant decrease in traffic deaths. However, the second figure below shows that there was actually a sudden increase before the law enforcement. Thus, the drop might not be correlated with law enforcement.</p>
<p><img src="traffic2.jpg" class="img-fluid" style="width:60.0%"></p>
<p>The line connecting the two datapoints in the first figure could have a variety of other time-paths before and after.</p>
<p><img src="traffic3.jpg" class="img-fluid"></p>
<p>Bringing other states into the picture further reveals that not only Connecticut had a sudden increase in 1955 in traffic deaths.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="traffic4.jpg" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption"><em>Adapted from Tufte (1983)</em></figcaption>
</figure>
</div>
<p>Think about the responsibility you have towards your reader. Depending on the platform and publication, showing an untruthful chart can lead to a lie being repeated thousands of times. Here are some principles you should consider in order to keep your graphs truthful (Tufte 1983, 77): 1. The representation of numbers should always be directly proportional to the numerical quantities represented. 2. Clear labelling should avoid ambiguities in interpreting graphs. In the best case, you write the labelling directly on the graph. Add important event labels. 3. Show data variation, not design variation. 4. Graphics shouldn’t quote data out of context 5. The number of dimensions in your graph should never exceed the number of dimensions in your data.</p>
</section>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>UN Icons https://thenounproject.com/ochavisual/collection/ocha-humanitarian-icons-v02/</p>
<p>https://vimeo.com/128373915</p>
<p>https://flowingdata.com/</p>
<p>https://govdna.frontwise.com/#layout/data/country/THA/x/12/y/5/z/8/a/0</p>
<p>https://projects.interacta.io/country-tsne/</p>
<p>Tufte in R: http://motioninsocial.com/tufte/#minimal-line-plot</p>
<p>Sarah Leo, a visual journalist at The Economist, looked through the archives and found some charts that could use a re-design. https://medium.economist.com/mistakes-weve-drawn-a-few-8cdd8a42d368</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>